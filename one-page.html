<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <title>Spectacle</title>
  </head>
  <body>
    <div id="root"></div>

    <script>
      // Polyfills.
      // **Note**: Because `import`s are hoisted, we need a separate, prior <script> block.
      window.process = window.process || { env: { NODE_ENV: "production" } };
      window.__DEV__ = false; // `react-is` needs.
    </script>
    <script id="deck" type="module">
      import React from 'react';
      import ReactDOM from 'react-dom';
      import {
        Deck,
        Slide,
        Appear,
        // CodePane, // TODO(ONE-PAGE): FIX CODE PANE / PRR
        FlexBox,
        Box,
        Image,
        Heading,
        ListItem,
        OrderedList,
        Quote,
        Text,
        UnorderedList,
        Grid,
        Notes
      } from './es/components/index.js';
      import htm from 'https://unpkg.com/htm@2.2.1?module';

      const html = htm.bind(React.createElement);

      // Example content.
      const formidableLogo = "./examples/js/formidable.png";
      const cppCodeBlock = `#include <iostream>

      int main()
      {
        auto curried_add = [](int x) -> function<int(int)> { return [=](int y) { return x + y; }; };

        auto answer = curried_add(7)(8);
        std::cout << answer << std::endl;

        return 0;
      }`;

      const deck = (
        html`<${Deck}
          template=${({ numberOfSlides, slideNumber }) => (
            html`<${FlexBox}
                justifyContent="space-between"
                position="absolute"
                bottom=${0}
                width=${1}
              >
                <${Text} fontSize=${12}>
                  Slide ${slideNumber} of ${numberOfSlides}
                <//>
                <${Box} padding=${10}>
                  <${Image} src=${formidableLogo} width=${100} />
                <//>
              <//>`
          )}
        >
          <${Slide}>
            <${Heading}>Spectacle<//>
            <${Text}>Hello There ðŸ¤—<//>
            <${Quote}>This is a Formidaquote!<//>
            <${OrderedList}>
              <${Appear} elementNum=${0}>
                <${ListItem}>This is an<//>
              <//>
              <${Appear} elementNum=${1}>
                <${ListItem}>ordered list<//>
              <//>
            <//>
            <${UnorderedList}>
              <${ListItem}>This is an<//>
              <${ListItem}>unordered list<//>
            <//>
            <${Notes}>
              <p>
                Notes are shown in presenter mode. Open up
                localhost:3000/?presenterMode=true to see them.
              <//>
            <//>
          <//>
          <${Slide}>
            <pre>TODO(ONE-PAGE) CodePane fontSize={18} language="cpp"
              {cppCodeBlock}
            <//>
            <${Notes}>
              <p>
                This is a code pane! It can support multiple programming languages.
              <//>
            <//>
          <//>
          <${Slide}>
            <${Text} fontSize="subHeader">Slide 3!<//>
            <${Appear} elementNum=${0}>
              <${Text}>Hey, just one "animated" slide element here<//>
            <//>
          <//>
          <${Slide}>
            <${Text}>I'm a static slide element that should always show<//>
            <${Text}>This means that we don't need a SlideElementWrapper<//>
            <${Appear} elementNum=${0}>
              <${Text}> ZERO Slide 4 x 3! <//>
            <//>
            <${Appear} elementNum=${1}>
              <${Text}> ONE Slide 4 x 3! <//>
            <//>
            <${Appear} elementNum=${2}>
              <${Text}> TWO Slide 4 x 3! <//>
            <//>
            <${Text}>I'm also a static non-animated "slide element"!<//>
          <//>
          <${Slide}>
            <${FlexBox}>
              <${Text}>These<//>
              <${Text}>Text<//>
              <${Text} color="secondary">Items<//>
              <${Text} fontWeight="bold">Flex<//>
            <//>
            <${Grid} gridTemplateColumns="1fr 2fr" gridColumnGap=${15}>
              <${Box} backgroundColor="primary">
                <${Text} color="secondary">Single-size Grid Item<//>
              <//>
              <${Box} backgroundColor="secondary">
                <${Text}>Double-size Grid Item<//>
              <//>
            <//>
            <${Heading}>Lots of Formidables!<//>
            <${Grid}
              gridTemplateColumns="1fr 1fr 1fr"
              gridTemplateRows="1fr 1fr 1fr"
              alignItems="center"
              justifyContent="center"
              gridRowGap=${15}
            >
            ${Array(9)
                .fill('')
                .map((_, index) => (
                  // TODO(ONE-PAGE): I don't see anything in dev or one-page (???)
                  html`<${FlexBox} key="formidable-logo-${index}">
                    <${Image} src=${formidableLogo} width=${100} />
                  <//>`
                ))}
            <//>
          <//>
        <//>`
      );

      ReactDOM.render(deck, document.getElementById('root'));
    </script>

    <!--
      Oh, the Hackage!
      ================

      ## Introduction

      The above code _looks_ like it should work, but it doesn't really.
      It errors with the `react` import. Which (for now) is expected because
      although we can rewrite the `react` import here to `es-react`, we
      **can't** for the dependents of our stuff. So, instead we do hacky stuff!

      We use https://github.com/guybedford/es-module-shims to smooth over things
      like `react` not supporting ESM by rewriting _during imports_ with Import
      Maps which **are** on the spec, just not implemented yet.

      Eventually, the below should work for us (just not yet...).

      ## Hacks

      - Unfortunately, we have to pattern match against unpkg resolutions, so
        we repeat the same `https://unpkg.com/react@{SEMVER_STRING}/?module` for
        each.
      - Right now `es-react` doesn't export named React members so we shim it
        here until https://github.com/lukejacksonn/es-react/issues/4 is fixed.
      - `query-string` is not ESM, so we use a fork `@chaitin/querystring`.

      ## Notes

      - https://unpkg.com/stylis-rule-sheet@0.0.10?module
        ISSUE: https://github.com/thysultan/stylis.js/issues/81
        SHIM: Manual copy and paste with export.
      - https://unpkg.com/stream@0.0.2?module
        FIX: Use `styled-components.browser.esm.js` which doesn't import.
      - https://unpkg.com/prop-types@15.7.2?module
        SHIM: Manual build in another temp project
      - https://unpkg.com/object-assign@4.1.1?module
        SHIM: Simple
      - https://unpkg.com/browse/stylis@3.5.4/
        HACK: Re-export off window from ESM
        PROBLEM: UMD, not ESM
        UPSTREAM: `import Stylis from /*"https://unpkg.com/stylis@^3.5.0/stylis.min?module"*/"blob:http://localhost:3000/61028930-a917-43a6-a1f1-7b96fe776f77";`

      // TODO(ONE-PAGE): Prism RR broken
      // "prism-react-renderer": "./one-page-temp-prism-react-renderer/es/index.js",
      // "prism-react-renderer/es/vendor/prism/index": "./one-page-temp-prism-react-renderer/es/vendor/prism/index.js",
      // "prism-react-renderer/es/themes/vsDark": "./one-page-temp-prism-react-renderer/es/themes/vsDark.js",
    -->
    <script type="importmap-shim">
      {
        "imports": {
          "history": "https://unpkg.com/history?module",
          "query-string": "https://unpkg.com/@chaitin/querystring?module",
          "https://unpkg.com/react@>=0.14.9?module": "./one-page/adapters/react.js",
          "https://unpkg.com/react@>= 16.3.0?module": "./one-page/adapters/react.js",
          "https://unpkg.com/react@>= 16.8.0?module": "./one-page/adapters/react.js",
          "https://unpkg.com/react@16.9.0?module": "./one-page/adapters/react.js",
          "react": "./one-page/adapters/react.js",
          "react-dom": "https://unpkg.com/es-react@16.8.60/src/react-dom.js",
          "https://unpkg.com/react-is@^16.6.0?module": "https://unpkg.com/react-is-esm@16.8.4-alpha.1/dist-web/index.js?module",
          "react-is": "https://unpkg.com/react-is-esm@16.8.4-alpha.1/dist-web/index.js?module",
          "react-spring": "https://unpkg.com/react-spring?module",
          "https://unpkg.com/object-assign@^4.1.1?module": "./one-page/shims/object-assign.js",
          "object-asign": "./one-page/shims/object-assign.js",
          "https://unpkg.com/prop-types@^15.5.4?module": "./one-page/shims/prop-types.js",
          "prop-types": "./one-page/shims/prop-types.js",
          "styled-components": "https://unpkg.com/styled-components@4.3.2/dist/styled-components.browser.esm.js?module",
          "styled-system": "https://unpkg.com/styled-system?module",
          "https://unpkg.com/stylis-rule-sheet@^0.0.10?module": "./one-page/adapters/stylis-rule-sheet.js",
          "stylis-rule-sheet": "./one-page/adapters/stylis-rule-sheet.js",
          "https://unpkg.com/stylis@^3.5.0/stylis.min?module": "https://unpkg.com/@emotion/stylis?module",
          "stylis": "https://unpkg.com/@emotion/stylis?module",
          "wonka": "https://unpkg.com/wonka?module"
        }
      }
    </script>
    <script>
      // HACK: Convert `module` which fails now (will work in future) to shimmed version
      // and then the code is run again with shims.
      document.querySelector('#deck').setAttribute("type", "module-shim");
    </script>
    <!-- TODO(ONE-PAGE): Remove _DEBUG script once everything works. -->
    <script type="text/javascript"
      src_DEBUG="./one-page/debug/es-module-shims.js"
      src="https://unpkg.com/es-module-shims@0.4.2/dist/es-module-shims.js"
    >
    </script>
  </body>
</html>
